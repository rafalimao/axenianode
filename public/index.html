<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Multi WhatsApp</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { text-align: center; font-family: sans-serif; padding: 50px; }
        img { margin-top: 20px; width: 200px; }
    </style>
</head>
<body>
    <h1>Multi Conexão WhatsApp</h1>
    <div id="status">🔄 Aguardando conexão...</div>
    <div id="qrcode"></div>

    <script>
        const socket = io();

        // Função para extrair ?user=xxx da URL
        function getUserIdFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('user');
        }

        const userId = getUserIdFromURL();

        if (userId) {
            socket.emit('start', userId);
            document.getElementById('status').innerText = `🔄 Conectando cliente: ${userId}`;
        } else {
            document.getElementById('status').innerText = '❌ Parâmetro "user" ausente na URL.';
        }

        socket.on('qr', (qr) => {
            document.getElementById('qrcode').innerHTML = `<img src="${qr}" alt="QR Code">`;
        });

        socket.on('ready', (msg) => {
            document.getElementById('status').innerText = msg;
            document.getElementById('qrcode').innerHTML = '';
        });

        socket.on('msg', (msg) => {
            document.getElementById('status').innerText = msg;
        });
    </script>
</body>
</html>
